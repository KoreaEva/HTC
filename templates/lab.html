<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë© ê´€ë¦¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            .header { flex-direction: column; gap: 15px; align-items: flex-start; }
            .header h1 { font-size: 20px; }
            table { font-size: 0.9em; }
            th, td { padding: 8px 6px; }
            .button { padding: 6px 12px; font-size: 13px; }
        }
        
        @media (max-width: 480px) {
            body { padding: 5px; }
            .container { padding: 10px; }
            .header h1 { font-size: 18px; }
            table { font-size: 0.8em; }
            th, td { padding: 6px 4px; }
            .button { padding: 5px 10px; font-size: 12px; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .header h1 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.danger {
            background: #dc3545;
        }
                 .button.danger:hover {
             background: #c82333;
         }
         .button.success {
             background: #28a745;
         }
         .button.success:hover {
             background: #218838;
         }
         .button.secondary {
             background: #6c757d;
         }
         .button.secondary:hover {
             background: #5a6268;
         }
        .refresh-button {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .refresh-icon {
            transition: transform 0.5s ease;
        }
        .refresh-icon.rotating {
            transform: rotate(360deg);
        }
        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cfd4da; transition: .2s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: #fff; transition: .2s; border-radius: 50%; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: #2196F3; }
        input:checked + .slider:before { transform: translateX(20px); }
        /* ë¹„í™œì„±í™” í–‰ */
        tr.inactive-row { opacity: 0.5; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            background: #fff;
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-actions {
            margin-top: 20px;
            text-align: right;
        }
        .form-actions button {
            margin-left: 10px;
        }
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="courseTitle">ë© ê´€ë¦¬</h1>
            <button class="button" onclick="showAddLabModal()">ë© ì¶”ê°€</button>
        </div>
        
        <!-- ë© ëª©ë¡ ì„¹ì…˜ -->
        <div style="margin-bottom: 30px;">
            <h2 style="color: #333; margin-bottom: 15px;">ë© ëª©ë¡</h2>
            <table>
                <thead>
                    <tr>
                        <th>ë© ID</th>
                        <th>ë©ëª…</th>
                        <th>ì½˜í…ì¸  ìˆ˜</th>
                        <th>ìƒì„±ì¼</th>
                        <th>ê´€ë¦¬</th>
                        <th>ë© ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody id="labList">
                    <!-- ë© ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>
        
        <!-- ì‚¬ìš©ì ëª©ë¡ ì„¹ì…˜ -->
        <div>
                         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                 <h2 style="color: #333; margin: 0;">ì‚¬ìš©ì ëª©ë¡</h2>
                 <div style="display: flex; align-items: center; gap: 15px;">
                     <div style="display: flex; align-items: center; gap: 8px;">
                         <span style="font-size: 14px; color: #666;">ìë™ ìƒˆë¡œê³ ì¹¨</span>
                         <label class="switch" title="ìë™ ìƒˆë¡œê³ ì¹¨">
                             <input type="checkbox" id="autoRefreshToggle" onchange="toggleAutoRefresh()">
                             <span class="slider"></span>
                         </label>
                     </div>
                     <button class="button refresh-button" onclick="loadUsers()" style="background: #28a745;">
                         <span id="refreshIcon" class="refresh-icon">ğŸ”„</span> ìƒˆë¡œê³ ì¹¨
                     </button>
                 </div>
             </div>
            <table>
                                 <thead>
                     <tr>
                         <th>ì‚¬ìš©ì ID</th>
                         <th>ì‚¬ìš©ìëª…</th>
                         <th>ë§ˆì§€ë§‰ ë³¸ ì½˜í…ì¸ </th>
                         <th>ê°€ì…ì¼</th>
                         <th>ê´€ë¦¬</th>
                     </tr>
                 </thead>
                <tbody id="userList">
                    <!-- ì‚¬ìš©ì ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ë© ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="labModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">ë© ì¶”ê°€</h2>
            <form id="labForm">
                <input type="hidden" id="labId">
                <div class="form-group">
                    <label for="labName">ë©ëª…:</label>
                    <input type="text" id="labName" required>
                </div>
                <div class="form-group">
                    <label for="labContent">ë© ë‚´ìš©:</label>
                    <textarea id="labContent" rows="4"></textarea>
                </div>
                                                 <div class="form-group">
                    <label for="labStatus">ë© ìƒíƒœ:</label>
                    <select id="labStatus" required>
                        <option value="20">í™œì„±í™”</option>
                        <option value="10">ë¹„í™œì„±í™”</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="submit" class="button">ì €ì¥</button>
                    <button type="button" class="button" onclick="closeModal('labModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <div id="moveContentModal" class="modal">
        <div class="modal-content">
            <h2>ì½˜í…ì¸  ì´ë™</h2>
            <form id="moveContentForm">
                <input type="hidden" id="moveContentId">
                <div class="form-group">
                    <label for="targetLabId">ì´ë™í•  ë©:</label>
                    <select id="targetLabId" required>
                        <!-- ë© ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="button">ì´ë™</button>
                    <button type="button" class="button" onclick="closeModal('moveContentModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì—ì„œ training_key ì¶”ì¶œ
        function getQueryParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }
        const trainingKey = getQueryParam('training_key');
        // ê³¼ì •ëª… ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadCourseTitle() {
            const res = await fetch(`/api/admin/courses/${trainingKey}`);
            if (res.ok) {
                const data = await res.json();
                document.getElementById('courseTitle').textContent = `[${data.course_name}] ë© ê´€ë¦¬`;
            }
        }
                 // ë© ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
         function getLabStatusText(status) {
             return status == 20 ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
         }
        // ë© ëª©ë¡ ë¡œë“œ
        async function loadLabs() {
            try {
                console.log('Loading labs for training_key:', trainingKey);
                const res = await fetch(`/api/admin/labs?training_key=${trainingKey}`);
                if (!res.ok) {
                    // HTTP ì˜¤ë¥˜ ì‘ë‹µì˜ ê²½ìš° ìƒíƒœ ì½”ë“œì™€ í…ìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì¶œë ¥
                    const errorText = await res.text();
                    throw new Error(`ë© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${res.status} ${res.statusText} - ${errorText}`);
                }
                const labs = await res.json();
                console.log('Loaded labs from API:', labs);
                
                const tbody = document.getElementById('labList');
                tbody.innerHTML = '';
                if (labs.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = '<td colspan="6" style="text-align:center;">ë©ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
                    tbody.appendChild(tr);
                    return;
                }
                labs.forEach(lab => {
                    console.log('Processing lab:', lab);
                    const tr = document.createElement('tr');
                    if (lab.lab_status != 20) {
                        tr.classList.add('inactive-row');
                    }

                    
                    tr.innerHTML = `
                        <td>${lab.lab_id}</td>
                        <td><a href="/admin/lab_content?training_key=${lab.training_key}&lab_id=${lab.lab_id}">${lab.lab_name}</a></td>
                        <td>${lab.content_count}</td>
                        <td>${lab.create_date}</td>
                        <td>
                            <button class="button" onclick="editLab(${lab.lab_id})" data-lab-id="${lab.lab_id}" data-lab-name="${lab.lab_name}">ìˆ˜ì •</button>
                            <button class="button danger" onclick="deleteLab(${lab.lab_id})">ì‚­ì œ</button>
                        </td>
                        <td>
                            <label class="switch" title="${getLabStatusText(lab.lab_status)}">
                                <input type="checkbox" ${lab.lab_status == 20 ? 'checked' : ''} onchange="toggleLabStatus(${lab.lab_id}, this)">
                                <span class="slider"></span>
                            </label>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error loading labs:', error);
                alert(`ë© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }
        // ë© ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        function showAddLabModal() {
            // ëª¨ë‹¬ í¼ ì´ˆê¸°í™”
            document.getElementById('modalTitle').textContent = 'ë© ì¶”ê°€';
            document.getElementById('labId').value = '';
            document.getElementById('labName').value = '';
            document.getElementById('labContent').value = '';
            document.getElementById('labStatus').value = 20;

            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('labModal').style.display = 'flex';
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // ëª¨ë‹¬ì´ ë‹«í ë•Œ í¼ ì´ˆê¸°í™”
            if (modalId === 'labModal') {
                document.getElementById('labForm').reset();
                document.getElementById('labId').value = '';
            }
        }
        // ë© ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        async function editLab(labId) {
            try {
                console.log('=== ë© ìˆ˜ì • ì‹œì‘ ===');
                console.log('ìš”ì²­ëœ lab_id:', labId);
                console.log('í˜„ì¬ training_key:', trainingKey);
                
                const res = await fetch(`/api/admin/labs/${labId}?training_key=${trainingKey}`);
                console.log('API ì‘ë‹µ ìƒíƒœ:', res.status, res.statusText);
                
                if (!res.ok) {
                    const errorText = await res.text();
                    console.error('API ì˜¤ë¥˜ ì‘ë‹µ:', errorText);
                    throw new Error(`ë© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${res.status} ${res.statusText} - ${errorText}`);
                }
                
                const lab = await res.json();
                console.log('ì„œë²„ì—ì„œ ë°›ì€ ë© ë°ì´í„°:', lab);
                
                // ëª¨ë‹¬ í¼ ì´ˆê¸°í™”
                document.getElementById('modalTitle').textContent = 'ë© ìˆ˜ì •';
                document.getElementById('labId').value = lab.lab_id || '';
                document.getElementById('labName').value = lab.lab_name || '';
                document.getElementById('labContent').value = lab.lab_content || '';
                document.getElementById('labStatus').value = lab.lab_status || 20;

                
                console.log('ëª¨ë‹¬ í¼ì— ì„¤ì •ëœ ê°’ë“¤:');
                console.log('- lab_id:', document.getElementById('labId').value);
                console.log('- lab_name:', document.getElementById('labName').value);
                console.log('- lab_status:', document.getElementById('labStatus').value);
                
                // ëª¨ë‹¬ í‘œì‹œ
                document.getElementById('labModal').style.display = 'flex';
                console.log('=== ë© ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ ===');
            } catch (error) {
                console.error('Error loading lab data:', error);
                alert(`ë© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }
                 // ë© ìƒíƒœ í† ê¸€ (í† ê¸€ ìŠ¤ìœ„ì¹˜)
         async function toggleLabStatus(labId, checkboxEl) {
             const newStatus = checkboxEl.checked ? 20 : 10;
             const rowEl = checkboxEl.closest('tr');
             // ì¦‰ì‹œ ì‹œê°ì  ë°˜ì˜
             if (newStatus === 20) {
                 rowEl.classList.remove('inactive-row');
             } else {
                 rowEl.classList.add('inactive-row');
             }
             try {
                 const payload = { training_key: trainingKey, lab_status: newStatus };
                 const res = await fetch(`/api/admin/labs/${labId}`, {
                     method: 'PUT',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(payload)
                 });
                 if (!res.ok) {
                     const errorText = await res.text();
                     // ì‹¤íŒ¨ ì‹œ ì›ë˜ ìƒíƒœë¡œ ë¡¤ë°±
                     checkboxEl.checked = !checkboxEl.checked;
                     if (checkboxEl.checked) rowEl.classList.remove('inactive-row'); else rowEl.classList.add('inactive-row');
                     alert(`ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorText}`);
                 }
             } catch (error) {
                 // ì˜¤ë¥˜ ì‹œ ì›ë˜ ìƒíƒœë¡œ ë¡¤ë°±
                 checkboxEl.checked = !checkboxEl.checked;
                 if (checkboxEl.checked) rowEl.classList.remove('inactive-row'); else rowEl.classList.add('inactive-row');
                 console.error('Error toggling lab status:', error);
                 alert(`ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
             }
         }
         
         // ë© ì‚­ì œ
         async function deleteLab(labId) {
             if (confirm('ì •ë§ë¡œ ì´ ë©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                 const res = await fetch(`/api/admin/labs/${labId}`, { method: 'DELETE' });
                 if (res.ok) loadLabs();
                 else alert('ë© ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
             }
         }
        // ë© ì¶”ê°€/ìˆ˜ì • í¼ ì œì¶œ
        document.getElementById('labForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const labId = document.getElementById('labId').value;
                const labName = document.getElementById('labName').value.trim();
                const labContent = document.getElementById('labContent').value.trim();
                const labStatus = parseInt(document.getElementById('labStatus').value);

                
                console.log('Form submission - labId:', labId, 'labName:', labName, 'labStatus:', labStatus);
                
                // ìœ íš¨ì„± ê²€ì‚¬
                if (!labName) {
                    alert('ë©ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const payload = {
                    training_key: trainingKey,
                    lab_name: labName,
                    lab_content: labContent,
                    lab_status: labStatus
                };
                
                let url = '/api/admin/labs';
                let method = 'POST';
                if (labId && labId.trim() !== '') {
                    url += `/${labId}`;
                    method = 'PUT';
                }
                
                console.log('Submitting to:', url, 'with method:', method, 'payload:', payload);
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                                 if (res.ok) {
                     console.log('Lab saved successfully');
                     closeModal('labModal');
                     loadLabs();
                 } else {
                    const errorText = await res.text();
                    console.error('Save failed:', res.status, errorText);
                    alert(`ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${res.status} ${res.statusText} - ${errorText}`);
                }
            } catch (error) {
                console.error('Error saving lab:', error);
                alert(`ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        });
        // ì½˜í…ì¸  ì´ë™ ëª¨ë‹¬ ì—´ê¸°
        async function openMoveContentModal(contentId) {
            const res = await fetch(`/api/admin/labs?training_key=${trainingKey}`);
            const labs = await res.json();
            
            const select = document.getElementById('targetLabId');
            select.innerHTML = '';
            labs.forEach(lab => {
                const option = document.createElement('option');
                option.value = lab.lab_id;
                option.textContent = lab.lab_name;
                select.appendChild(option);
            });
            
            document.getElementById('moveContentId').value = contentId;
            document.getElementById('moveContentModal').style.display = 'block';
        }
        // ì½˜í…ì¸  ì´ë™ ì²˜ë¦¬
        document.getElementById('moveContentForm').onsubmit = async (e) => {
            e.preventDefault();
            const contentId = document.getElementById('moveContentId').value;
            const newLabId = document.getElementById('targetLabId').value;
            
            try {
                const res = await fetch(`/api/admin/lab_contents/${contentId}/move`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ new_lab_id: newLabId })
                });
                
                if (res.ok) {
                    alert('ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeModal('moveContentModal');
                    loadLabContents(); // ì½˜í…ì¸  ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadLabs(); // ë© ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (ì½˜í…ì¸  ìˆ˜ ì—…ë°ì´íŠ¸)
                } else {
                    const error = await res.json();
                    alert(error.detail || 'ì½˜í…ì¸  ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ì½˜í…ì¸  ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };
        // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
        async function loadUsers() {
            try {
                // ìƒˆë¡œê³ ì¹¨ ì•„ì´ì½˜ íšŒì „ ì• ë‹ˆë©”ì´ì…˜
                const refreshIcon = document.getElementById('refreshIcon');
                refreshIcon.classList.add('rotating');
                
                const response = await fetch(`/api/admin/users/course/${trainingKey}`);
                if (!response.ok) {
                    throw new Error('ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                const users = await response.json();
                const tbody = document.getElementById('userList');
                tbody.innerHTML = '';
                
                if (users.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = '<td colspan="5" style="text-align:center;">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</td>';
                    tbody.appendChild(tr);
                    return;
                }
                
                                 users.forEach(user => {
                     const tr = document.createElement('tr');
                     const lastContent = user.last_content || 'ì½˜í…ì¸ ë¥¼ ë³¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤';
                     tr.innerHTML = `
                         <td>${user.member_id}</td>
                         <td>${user.member_name}</td>
                         <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${lastContent}">${lastContent}</td>
                         <td>${user.create_date}</td>
                         <td>
                             <button class="button danger" onclick="deleteUser('${user.member_id}')">ì‚­ì œ</button>
                         </td>
                     `;
                     tbody.appendChild(tr);
                 });
                
                // ìƒˆë¡œê³ ì¹¨ ì•„ì´ì½˜ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ
                setTimeout(() => {
                    refreshIcon.classList.remove('rotating');
                }, 500);
                
            } catch (error) {
                console.error('Error loading users:', error);
                alert(`ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }
        
        // ì‚¬ìš©ì ì‚­ì œ
        async function deleteUser(userId) {
            if (confirm('ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const response = await fetch(`/api/admin/users/${userId}`, { method: 'DELETE' });
                    if (response.ok) {
                        loadUsers(); // ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    } else {
                        alert('ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
                 // ìë™ ìƒˆë¡œê³ ì¹¨ ê´€ë ¨ ë³€ìˆ˜
         let autoRefreshInterval = null;
         
         // ìë™ ìƒˆë¡œê³ ì¹¨ í† ê¸€ í•¨ìˆ˜
         function toggleAutoRefresh() {
             const toggle = document.getElementById('autoRefreshToggle');
             
             if (toggle.checked) {
                 // ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘
                 startAutoRefresh();
             } else {
                 // ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€
                 stopAutoRefresh();
             }
         }
         
         // ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘
         function startAutoRefresh() {
             // ê¸°ì¡´ ì¸í„°ë²Œì´ ìˆë‹¤ë©´ ì œê±°
             if (autoRefreshInterval) {
                 clearInterval(autoRefreshInterval);
             }
             
             // 5ì´ˆë§ˆë‹¤ ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
             autoRefreshInterval = setInterval(() => {
                 console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰');
                 loadUsers();
             }, 5000);
             
             console.log('ìë™ ìƒˆë¡œê³ ì¹¨ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. (5ì´ˆ ê°„ê²©)');
         }
         
         // ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€
         function stopAutoRefresh() {
             if (autoRefreshInterval) {
                 clearInterval(autoRefreshInterval);
                 autoRefreshInterval = null;
                 console.log('ìë™ ìƒˆë¡œê³ ì¹¨ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
             }
         }
         
         // í˜ì´ì§€ ë¡œë“œì‹œ
         loadCourseTitle();
         loadLabs();
         loadUsers();
         
         // í˜ì´ì§€ë¥¼ ë²—ì–´ë‚  ë•Œ ìë™ ìƒˆë¡œê³ ì¹¨ ì •ë¦¬
         window.addEventListener('beforeunload', function() {
             stopAutoRefresh();
         });
    </script>
</body>
</html> 